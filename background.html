<html>
	<script>
	
	function post(url, params, callback){
		var xhr = new XMLHttpRequest();
		xhr.open("POST", url, true);   
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
//		xhr.setRequestHeader("Content-length", params.length);
//		xhr.setRequestHeader("Connection", "close");			
		var teste = chrome.extension.getViews()[0];
		xhr.onreadystatechange = function(){
		 callback(xhr.responseText);		  
		}
		xhr.send(params);	
	}
	
	function is_authenticate(callback){
		var url = "https://readitlaterlist.com/v2/auth";
		var params = 	"username="+localStorage["rilName"]+
				"&password="+localStorage["rilPassword"]+
				"&apikey=158guBdkp52ePOcF54T3c16Qf2Akl517";
				
		post(url, params, callback);
		ril_auth();
	}
	
	function ril_auth(){
		var url = "http://readitlaterlist.com/login_process";
		var params = 	"feed_id="+localStorage["rilName"]+
				"&password="+localStorage["rilPassword"];	
				
		var xhr = new XMLHttpRequest();
		xhr.open("POST", url, false);   
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.setRequestHeader("Content-length", params.length);
		xhr.setRequestHeader("Connection", "close");			
		var teste = chrome.extension.getViews()[0];

		xhr.send(params);
		xhr.responseText;	
	}
		
	function add(callback, addurl, title){
		var url = "https://readitlaterlist.com/v2/add";
		var params =	"username="+localStorage["rilName"]+
				"&password="+localStorage["rilPassword"]+
				"&apikey=158guBdkp52ePOcF54T3c16Qf2Akl517"+
				"&url="+addurl+
				"&title="+title;
					  
		post(url, params, callback);		
	}
		

	function get(callback, time){
		var url = "https://readitlaterlist.com/v2/get";
		var params ="password="+localStorage["rilPassword"]+
				"&apikey=158guBdkp52ePOcF54T3c16Qf2Akl517"+
				"&username="+localStorage["rilName"]+
				"&since="+time+
				"&state=\"0\"";				

		post(url, params, callback);		
	}
		
	function send(callback, read_list){
		var url = "https://readitlaterlist.com/v2/send";
		var params = 	"username="+localStorage["rilName"]+
			    	"&password="+localStorage["rilPassword"]+
				"&apikey=158guBdkp52ePOcF54T3c16Qf2Akl517";
					
		params += make_send_param(read_list);		
		post(url, params, callback);		
	}
	
	function get_uncount_number(callback){
		stats(callback);
	}
	
	function stats(callback){
	
		var url = "https://readitlaterlist.com/v2/stats";
		var params = 	"username="+localStorage["rilName"]+
			    	"&password="+localStorage["rilPassword"]+
				"&apikey=158guBdkp52ePOcF54T3c16Qf2Akl517";
		
		post(url, params, callback);
	}
		
	function make_send_param(list){
		var params = "";
		for(var i = 0; i < list.length; i++){
			params = params +  "\""+ i + "\":{" + "\"url\":\""+ list[i] + "\"" + "},"; 		               
		}
		  
		if(params.length > 0){
			params = params.substr(0, params.length - 1);
			params = "&read={"+params+"}";
		}
		return params;
	}
		
	function add_2_ril(){
		
	}			

	
	function _add_callback(resp){
		resp;
		
	}
	
	function update_list_content(time){
	    
	}
		
	</script>	
</html>
