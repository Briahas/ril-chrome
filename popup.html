<!--api key= 158guBdkp52ePOcF54T3c16Qf2Akl517-->
<html>
<head>
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Molengo">
  
	<style>
		body {
			font-family: 'Molengo', serif;
			font-size: 14px;
			width: 300px;
			height: 300px;
		}
     
		#add_button{
			cursor:pointer;
		} 
     
		#sync_button{
			cursor:pointer;
		}
     
		.list_span{
			cursor:pointer;
			width: 100%;
			height: 100%;
		}
		
		#list_div{
			position:absolute;
			top: 70px;
		}
		
		#load_div{
			background: #000000;
			opacity: 0.2;
			width: 300px;
			height: 300px;
			position:absolute;
			top: 0px;
		}
     
		td{
			font-size:12px;
		}
	</style>
  
	<script>
	  
		function show_options(){
			var html_content = "";
			html_content +=	"<span id=\"add_button\"  onclick=\"add()\">Add</span><br>" + 
					"<span id=\"sync_button\" onclick=\"load_mylist()\">Sync List</span><br>"+
					"<span onclick=\"my_list()\">My List</span><br>"+		                        
					"<div id=\"list_div\">"+		                        
					localStorage["ril_mylist"]+		                          
					"</div>";
			
			document.getElementById("page_body").innerHTML = html_content;
		}
	  
		function add(){
			show_load_screen();
			setTimeout("_add_aux()", 10);
			_add_aux();   
		}
		
		function _add_aux(){
			chrome.tabs.getSelected(null, function(tab) {
			var url = tab.url;
			var title = tab.title;
			_add(url,title);        
			});
		}
	  
		function _add(url, title){
			var bgPage = chrome.extension.getBackgroundPage();	
			bgPage.add(url, title);
			_load_mylist();
		}
	
		function mark_as_read(url, id){
			change_list_elem_style(id);
			setTimeout("_mark_as_read('"+url+"')", 10);
		}
		
		function show_load_screen(){
			document.getElementById("list_div").style.opacity = 0.4;
		}
		
		function hide_load_screen(){
			var op = document.getElementById("list_div").style.opacity;			
			change_opacity(parseFloat(op));
		}
		
		function change_opacity(op){
			if(op < 1){
				setTimeout("_change_opacity(\""+op+"\")", 20);
			}else{
				document.getElementById("list_div").style.opacity = 1;
			}			
		}
		
		function _change_opacity(op){
			if(op < 1){				
				document.getElementById("list_div").style.opacity = op;
				var opa = parseFloat(op);
				opa = opa + 0.1;
				change_opacity(opa);
			}	
		}
		
		function change_list_elem_style(id){					
			var elem = document.getElementById("line_"+id);
			elem.style.opacity = 0.3;
			elem.style.textDecoration = "line-through";
		}
	  
		function _mark_as_read(url){
			var bgPage = chrome.extension.getBackgroundPage();	
			var array = new Array();
			array[0] = url;
			bgPage.send(array);
			_load_mylist();
		}
	
		function load_mylist(){
			show_load_screen();
			setTimeout("_load_mylist()", 10);
		}
	
		function _load_mylist(){			
			var bgPage = chrome.extension.getBackgroundPage();			
			if(bgPage.is_authenticate()){
				var list = bgPage.get();
				list.sort(function(a, b){			
						if(a.time_updated > b.time_updated)
							return 1;
						else if (a.time_updated < b.time_updated)	
							return -1;
						return 0;
				});
				var list_content = "";
				for(var i = 0; i < list.length; i++){
					var obj = list[i];
					if(obj.state == "0"){
						list_content += ""+
						"<tr id=\"line_"+i+"\" ><td>"+
						"<span class=\"list_span\" id=\"list_img_"+i+"\" onclick=\"mark_as_read('"+obj.url+"', "+i+")\">"+
							"<img src='unread.png'>"+
						"</span>"+
						"</td><td>"+
						"<span>"+
							"<a href=\""+obj.url+"\" target=\"_blank\">"+obj.title+"</a>"+
						"</span>"+
						"</td></tr>";
					}
				}
				list_content = "<table>" + list_content + "</table>";
				localStorage["ril_mylist"] = list_content; 
				document.getElementById("list_div").innerHTML = list_content;
			}
			else{
				document.getElementById("page_body").innerHTML = "You are not logged yet!!";
			}
			hide_load_screen();
		}
		
		
		function get_domain(url){
			url = url.replace(/https?/,"");
			url = url.replace("://", "");
			var index = url.indexOf("/");
			url = "http://" + url.substr(0, index);
			return url;
		}
		
		function sort_function(a, b){			
			if(a.time_updated > b.time_updated)
				return 1;
			else if (a.time_updated < b.time_updated)	
				return -1;
			return 0;
		}
		
	</script>	
</head>
<body onload="show_options()">	  
	<div id="page_body">
		  
	</div>
</body>
</html>
