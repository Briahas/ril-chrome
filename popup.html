<!--api key= 158guBdkp52ePOcF54T3c16Qf2Akl517-->
<html>
<head>
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Molengo">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Reenie+Beanie">
  
	<style>
		body {
			font-family: 'Molengo', serif;
			font-size: 14px;
			width: 300px;
			height: 300px;
			background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#FFFFFF), to(#DDDDDD));
		}
     
		#add_button{
			cursor:pointer;
		} 
     
		#sync_button{
			cursor:pointer;
		}
     
		.list_span{
			cursor:pointer;
			width: 100%;
			height: 100%;
		}
		
		#list_div{
			position:absolute;
			top: 70px;
		}
		
		#load_div{
			background: #000000;
			opacity: 0.2;
			width: 300px;
			height: 300px;
			position:absolute;
			top: 0px;
		}
     
		td{
			font-size:14px;
			border-top: navy solid thin;
			border-color:  #CCCCCC;
		}
		a{
		  color: black;
		  text-decoration:none; 
		}
		

		#sync_button{
		  float: right;
		}
		
		#ext_title{
		  font-family: 'Reenie Beanie', serif;
		  font-size: 40px;
		}
		
		.url_domain{
		  font-size: 12px;
		  color: #CCCCCC;
		}
		
		.favicon{
		  height: 16px;
		  width: 16px;
		}
		
		table{
      border-collapse: collapse;
		}
		
		.no_border{
		  border: none;
		}
	</style>
  
	<script>
	  
		function show_options(){
			var html_content = "";
			html_content +=	"<header><span id=\"add_button\"  onclick=\"add()\"><img id=\"add_img\" title=\"Add to Read It Later\" src=\"bookmark.png\"></img></span>" + 
			    "<span id=\"ext_title\">IWILLRIL</span>"+
					"<span id=\"sync_button\" onclick=\"load_mylist()\"><img id=\"refresh_img\" title=\"Synchronize List\" src=\"refresh.png\"></img></span>"+
					"</header>"+		                        
					"<div id=\"list_div\">"+		                        
					localStorage["ril_mylist"]+		                          
					"</div>";
			
			document.getElementById("page_body").innerHTML = html_content;
			setTimeout("_show_options()", 10);

		}
		
		function _show_options(){
      if(localStorage["favicons"]){
			  var favicons = localStorage["favicons"].split("||||");			  
        insert_favicons(favicons);
			}
		  
		}
	  
		function add(){
		  document.getElementById("add_img").src = "bookmark_press.png";
			show_load_screen();
			setTimeout("_add_aux()", 10);
			_add_aux();   
		}
		
		function _add_aux(){
			chrome.tabs.getSelected(null, function(tab) {
			var url = tab.url;
			var title = tab.title;
			_add(url,title);        
			});
		}
	  
		function _add(url, title){
			var bgPage = chrome.extension.getBackgroundPage();	
			bgPage.add(url, title);
			_load_mylist();
		}
	
		function mark_as_read(url, id){
			change_list_elem_style(id);
			setTimeout("_mark_as_read('"+url+"')", 10);
		}
		
		function show_load_screen(){
			document.getElementById("list_div").style.opacity = 0.4;
		}
		
		function hide_load_screen(){
			var op = document.getElementById("list_div").style.opacity;			
			change_opacity(parseFloat(op));
		}
		
		function change_opacity(op){
			if(op < 1){
				setTimeout("_change_opacity(\""+op+"\")", 20);
			}else{
				document.getElementById("list_div").style.opacity = 1;
			}			
		}
		
		function _change_opacity(op){
			if(op < 1){				
				document.getElementById("list_div").style.opacity = op;
				var opa = parseFloat(op);
				opa = opa + 0.1;
				change_opacity(opa);
			}	
		}
		
		function change_list_elem_style(id){					
		  document.getElementById("img_line_"+id).src = "uncheck.png";
			var elem = document.getElementById("line_"+id);
			elem.style.opacity = 0.3;
			elem.style.textDecoration = "line-through";
		}
	  
		function _mark_as_read(url){
			var bgPage = chrome.extension.getBackgroundPage();	
			var array = new Array();
			array[0] = url;
			bgPage.send(array);
			_load_mylist();
		}
	
		function load_mylist(){
		  document.getElementById("refresh_img").src = "refresh_press.png";
			show_load_screen();
			setTimeout("_load_mylist()", 10);
		}
		
		function change_title_style(id, style){
		  if(style == 'on'){		  
		      document.getElementById('title_span_'+id).style.textDecoration = "underline";
		  }else{
		    document.getElementById('title_span_'+id).style.textDecoration = "none";
		  }
		}
	
		function _load_mylist(){			
			var bgPage = chrome.extension.getBackgroundPage();			
			if(bgPage.is_authenticate()){
				var list = bgPage.get();
				list.sort(function(a, b){			
						if(a.time_updated > b.time_updated)
							return 1;
						else if (a.time_updated < b.time_updated)	
							return -1;
						return 0;
				});
				
				var favicons = new Array();
				
				var list_content = "";
				for(var i = 0; i < list.length; i++){
					var obj = list[i];
					if(obj.state == "0"){
					  favicons[i] = get_domain(obj.url)+"/favicon.ico";
					  
					  var title = obj.title;
					  if(title.length > 38){
					    title = title.substr(0, 38) + "...";
					  }
					  
						list_content += ""+
						"<tr id=\"line_"+i+"\" >"+
						  "<td class=\"no_border\">"+
                "<span><img id=\"favicon_"+i+"\" class=\"favicon\"></img></span>"+
						  "</td>"+
						  "<td>"+
						  "<span id=\"title_span_"+i+"\" onmouseout=\"change_title_style('"+i+"', 'off')\" onmouseover=\"change_title_style('"+i+"', 'on')\">"+
							  "<a href=\""+obj.url+"\" target=\"_blank\" title=\""+obj.title+"\">"+title+"</a>"+
							  "</span>"+
							  "<br><label class=\"url_domain\">"+get_domain(obj.url)+"</label>"+
						  "</td>"+
						  "<td class=\"no_border\">"+
						  "<span class=\"list_span\" id=\"list_img_"+i+"\" onclick=\"mark_as_read('"+obj.url+"', "+i+")\">"+
							  "<img  title=\"Mark as Read\" id=\"img_line_"+i+"\" src='check.png'>"+
						  "</span>"+
						  "</td>"
						"</tr>";
					}
				}
				list_content = "<table cellpadding=\"5\" >" + list_content + "</table>";
				localStorage["ril_mylist"] = list_content; 
				
				var local_storage_favicons = favicons.join("||||");				
				localStorage["favicons"] = local_storage_favicons;
				document.getElementById("list_div").innerHTML = list_content;
			}
			else{
				document.getElementById("page_body").innerHTML = "You are not logged yet!!";
			}
			hide_load_screen();
			insert_favicons(favicons);
			document.getElementById("refresh_img").src = "refresh.png";
			document.getElementById("add_img").src = "bookmark.png";
		}
		
		
		function insert_favicons(favicons){
		  for(var i = 0; i < favicons.length; i++){
		    document.getElementById("favicon_"+i).src = "\""+favicons[i]+"\"";
		  }
		}
		
		function get_domain(url){
			url = url.replace(/https?/,"");
			url = url.replace("://", "");
			var index = url.indexOf("/");
			url = "http://" + url.substr(0, index);
			return url;
		}
		
		function sort_function(a, b){			
			if(a.time_updated > b.time_updated)
				return 1;
			else if (a.time_updated < b.time_updated)	
				return -1;
			return 0;
		}
		
	</script>	
</head>
<body onload="show_options()">	  
	<div id="page_body">
		  
	</div>
</body>
</html>
